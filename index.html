<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Machine Management</title>
    <link rel="stylesheet" href="Machines.css">
    <style>
        .kwmin {
            padding-right: 25px;
        }
        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: #151527; 
        }

        ::-webkit-scrollbar-thumb {
            background-color: #262645; 
            border-radius: 20px; 
            border: 3px solid #151527; 
        }

        ::-webkit-scrollbar-thumb:hover {
            background-color: #262646;
        }
        body {
            font-family: Arial, sans-serif;
            background-color: #151527;
            color: #fff;
            margin: 0;
            padding: 0;
        }
        .left-panel, .right-panel {
            width: 30%;
            padding: 10px;
            border-radius: 8px;
            background-color: #2e2e53;
            height: calc(100vh - 40px);
            overflow-y: auto;
            position: relative;
        }
        .machine-card {
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: 0.2s ease-in-out;
        }
        
        .machine-details {
            margin-top: 5px;
            margin-right: 50px;
        }
        .delete-button {
            margin-top: 0px;
            margin-right: 0px;
            color: white;
            background-color: #ff4d4d;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        .delete-button:hover {
            background-color: #ff1a1a;
        }
        #addMachineButton {
            margin-top: 10px;
            color: white;
            background-color: #4CAF50;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
        #addMachineButton:hover {
            background-color: #45a049;
        }
        .machine-card:hover {
            background-color: #262646;
            transition: 0.2s ease-in-out;
        }
        select {
            font-size: 16px;
            padding: 5px;
            border-radius: 5px;
            width: 100%;
            border: 1px solid #cccccc00;
            background-color: #262646;
            box-sizing: border-box;
            margin-bottom: 10px;
            color: #fff;
        }
        .machine-instance {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        .machine-instance img {
            width: 100px;
            height: 100px;
            margin-bottom: 10px;
        }
        .upgrades-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .upgrades-container div {
            margin: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        /* Machine-specific classes */
        #totalKwMin {
            position: sticky;
            bottom: 10px;
            background-color: #262646;
            color: #fff;
            padding: 10px;
            margin-top: 10px;
        }
        .container {
            display: flex;
            justify-content: space-between;
            margin: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="left-panel">
            <h2>Ajouter une Machine</h2>
            <select id="machineSelect"></select>
            <button class="test" id="addMachineButton">Ajouter une machine</button>
            <h2>Machines Ajoutées</h2>
            <div id="machineListContainer"></div>
            <p id="totalKwMin">Production Totale: 0 kW/min, Consommation Totale: 0 kW/min</p>
        </div>
        <div class="right-panel">
            <h2 style="text-align: center;">Détails de la Machine</h2>
            <div id="machineInstances"></div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const machines = [
                { name: "Panneaux solaires", rate: 1, type: 'production' },
                { name: "Panneaux solaire amélioré", rate: 4, type: 'production' },
                { name: "Générateur à charbon", rate: 10, type: 'production' },
                { name: "Groupe électrogène", rate: 65, type: 'production' },
                { name: "Machine de réparation", rate: 15, type: 'consumption' },
                { name: "Réparateur industriel", rate: 100, type: 'consuption'},
                { name: "Ecotron", rate: 100, type: 'consuption'},
                { name: "Imprimante", rate: 100, type: 'consuption'},
                { name: "Compresseur électrique", rate: 100, type: 'consuption'},
                { name: "Machine à potions", rate: 100, type: 'consuption'},
                { name: "Concasseur", rate: 100, type: 'consuption'}
            ];

            const upgrades = [
                { name: "Amélioration du rayon d'action", range: 20, energy: 20 },
                { name: "Amélioration de durabilité", durability: 20, energy: 10 },
                { name: "Amélioration de production", production: 20, energy: 20 },
                { name: "Amélioration de consommation", energy: -30 }
            ];

            let addedMachines = [];
            let selectedMachineIndex = null;

            function generateMachineOptions() {
                const select = document.getElementById('machineSelect');
                machines.forEach(machine => {
                    const option = document.createElement('option');
                    option.value = machine.name;
                    option.textContent = machine.name;
                    select.appendChild(option);
                });
            }

            function handleMachineSelection() {
                const select = document.getElementById('machineSelect');
                const selectedMachineName = select.value;
                const machine = machines.find(m => m.name === selectedMachineName);

                if (machine) {
                    const newMachine = {
                        ...machine,
                        durability: 100,
                        upgrades: []
                    };
                    addedMachines.push(newMachine);
                    updateMachineList();
                }
            }

            function updateMachineList() {
                const listContainer = document.getElementById('machineListContainer');
                listContainer.innerHTML = '';

                addedMachines.forEach((machine, index) => {
                    const machineCard = document.createElement('div');
                    machineCard.className = 'machine-card';

                    const machineImage = document.createElement('img');
                    machineImage.src = `/images/${machine.name.replace(/\s+/g, '-')}.webp`;
                    machineImage.alt = machine.name;
                    machineImage.className = `list-${machine.name.replace(/\s+/g, '-')}`;

                    const machineInfo = document.createElement('div');

                    const machineTitle = document.createElement('div');
                    machineTitle.textContent = machine.name;

                    const machineDetails = document.createElement('div');
                    machineDetails.className = 'machine-details';
                    const currentRate = calculateMachineRate(machine);
                    machineDetails.className = 'kwmin'
                    machineDetails.textContent = `${machine.durability}% | ${currentRate.toFixed(2)}kW/min`;

                    const upgradeIconsContainer = document.createElement('div');
                    upgradeIconsContainer.className = 'upgrade-icons';
                    machine.upgrades.forEach(upgradeName => {
                        const upgrade = upgrades.find(u => u.name === upgradeName);
                        if (upgrade) {
                            const upgradeIcon = document.createElement('img');
                            upgradeIcon.src = `/images/upgrade-2-${upgradeName.replace(/\s+/g, '-')}.webp`;
                            upgradeIcon.alt = upgradeName;
                            upgradeIcon.className = 'upgrade-2';
                            upgradeIconsContainer.appendChild(upgradeIcon);
                        }
                    });

                    const deleteButton = document.createElement('button');
                    deleteButton.className = 'delete-button';
                    deleteButton.textContent = 'Supprimer';
                    deleteButton.addEventListener('click', () => {
                        addedMachines.splice(index, 1);
                        updateMachineList();
                        clearMachineDetails();
                        selectedMachineIndex = null;
                    });

                    machineCard.addEventListener('click', () => {
                        selectedMachineIndex = index;
                        displayMachineDetails(index);
                    });

                    machineInfo.appendChild(machineTitle);
                    machineInfo.appendChild(machineDetails);
                    machineInfo.appendChild(upgradeIconsContainer);
                    machineCard.appendChild(machineImage);
                    machineCard.appendChild(machineInfo);
                    machineCard.appendChild(deleteButton);
                    listContainer.appendChild(machineCard);
                });

                calculateTotalRate();
                if (selectedMachineIndex === null) {
                    clearMachineDetails();
                }
            }

            function clearMachineDetails() {
                const machineDetailsContainer = document.getElementById('machineInstances');
                machineDetailsContainer.innerHTML = '';
                machineDetailsContainer.style.display = 'none';
            }

            function displayMachineDetails(index) {
                if (index === null || index >= addedMachines.length) {
                    clearMachineDetails();
                    return;
                }

                const machineDetailsContainer = document.getElementById('machineInstances');
                machineDetailsContainer.innerHTML = '';
                const machine = addedMachines[index];

                const headerContainer = document.createElement('div');
                headerContainer.style.textAlign = 'center';
                headerContainer.style.marginBottom = '20px';

                const machineImage = document.createElement('img');
                machineImage.src = `/images/${machine.name.replace(/\s+/g, '-')}.webp`;
                machineImage.alt = machine.name;
                machineImage.className = machine.name.replace(/\s+/g, '-');
                headerContainer.appendChild(machineImage);

                const title = document.createElement('h3');
                title.textContent = machine.name;
                headerContainer.appendChild(title);

                machineDetailsContainer.appendChild(headerContainer);

                const detailsDiv = document.createElement('div');
                detailsDiv.style.textAlign = 'center';

                const durabilityLabel = document.createElement('label');
                durabilityLabel.textContent = 'Durabilité: ';
                detailsDiv.appendChild(durabilityLabel);

                const durabilityInput = document.createElement('input');
                durabilityInput.type = 'number';
                durabilityInput.value = machine.durability;
                durabilityInput.min = 0;
                durabilityInput.max = 100;
                durabilityInput.style.margin = '10px 0';
                durabilityInput.addEventListener('input', (e) => {
                    machine.durability = Math.max(0, parseInt(e.target.value));
                    updateMachineList();
                });
                detailsDiv.appendChild(durabilityInput);
               
                const upgradesContainer = document.createElement('div');
                upgradesContainer.className = 'upgrades-container';

                upgrades.forEach(upgrade => {
                    const upgradeDiv = document.createElement('div');

                    const upgradeImage = document.createElement('img');
                    upgradeImage.src = `/images/${upgrade.name.replace(/\s+/g, '-')}.webp`;
                    upgradeImage.alt = upgrade.name;
                    upgradeImage.className = 'upgrade-2-icon';

                    const upgradeCheckbox = document.createElement('input');
                    upgradeCheckbox.type = 'checkbox';
                    upgradeCheckbox.checked = machine.upgrades.includes(upgrade.name);
                    upgradeCheckbox.addEventListener('change', (e) => {
                        if (e.target.checked) {
                            machine.upgrades.push(upgrade.name);
                        } else {
                            machine.upgrades = machine.upgrades.filter(u => u !== upgrade.name);
                        }
                        updateMachineList();
                    });
                    
                    upgradeDiv.appendChild(upgradeImage);
                    upgradeDiv.appendChild(upgradeCheckbox);
                    upgradesContainer.appendChild(upgradeDiv);
                });

                machineDetailsContainer.appendChild(detailsDiv);
                machineDetailsContainer.appendChild(upgradesContainer);
                machineDetailsContainer.style.display = 'block';
            }

            function calculateMachineRate(machine) {
                let machineRate = machine.rate;

                machine.upgrades.forEach(upgradeName => {
                    const upgrade = upgrades.find(u => u.name === upgradeName);
                    if (upgrade) {
                        if (machine.type === 'production' && upgrade.production) {
                            machineRate += (machine.rate * upgrade.production / 100);
                        }
                        if (machine.type === 'consumption' && upgrade.energy) {
                            machineRate += (machine.rate * upgrade.energy / 100);
                        }
                    }
                });

                machineRate *= (machine.durability / 100);
                return machineRate;
            }

            function calculateTotalRate() {
                let totalProduction = 0;
                let totalConsumption = 0;

                addedMachines.forEach(machine => {
                    const rate = calculateMachineRate(machine);
                    if (machine.type === 'production') {
                        totalProduction += rate;
                    } else {
                        totalConsumption += rate;
                    }
                });

                document.getElementById('totalKwMin').textContent = `Production Totale: ${totalProduction.toFixed(2)} kW/min, Consommation Totale: ${totalConsumption.toFixed(2)} kW/min`;
            }

            generateMachineOptions();

            document.getElementById('addMachineButton').addEventListener('click', handleMachineSelection);
        });
    </script>
</body>
</html>

